<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">UVMHS.Lib.OldSubstitution</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- </span><span>
</span><span id="line-3"></span><span class="hs-comment">-- import UVMHS.Core</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- import UVMHS.Lib.Pretty</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- -- import UVMHS.Lib.Testing</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- -- import UVMHS.Lib.Annotated</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- import UVMHS.Lib.Rand</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- import UVMHS.Lib.OldVariables</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- -- import UVMHS.Lang.ULCD</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- </span><span>
</span><span id="line-11"></span><span class="hs-comment">-- class (&#8704; a. Null (t a)) &#8658; Substy t where</span><span>
</span><span id="line-12"></span><span class="hs-comment">--   &#120008;var &#8759; t a &#8594; &#120144; &#8594; &#120144; &#8744; (&#119874; (t Void) &#8743; a)</span><span>
</span><span id="line-13"></span><span class="hs-comment">--   &#120008;shift &#8759; &#8469;64 &#8594; t a &#8594; t a</span><span>
</span><span id="line-14"></span><span class="hs-comment">--   &#120008;combine &#8759; (Monad m) &#8658; (t a &#8594; b &#8594; m a) &#8594; t a &#8594; t b &#8594; m (t a)</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- </span><span>
</span><span id="line-16"></span><span class="hs-comment">-- class Substable m s e a | a&#8594;e,a&#8594;s where</span><span>
</span><span id="line-17"></span><span class="hs-comment">--   gsubstS &#8759; (Substy t,Monad m) &#8658; (b &#8594; m e) &#8594; s &#8688; t b &#8594; a &#8594; m a</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- </span><span>
</span><span id="line-19"></span><span class="hs-comment">-- instance Substable m () Void Void where gsubstS _ _ = \case</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- </span><span>
</span><span id="line-21"></span><span class="hs-comment">-- gsubst &#8759; (Substy t,Substable m () e a,Monad m) &#8658; (b &#8594; m e) &#8594; t b &#8594; a &#8594; m a</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- gsubst &#120011; = gsubstS &#120011; &#8728; (&#8614;) ()</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- </span><span>
</span><span id="line-24"></span><span class="hs-comment">-- msubstS &#8759; (Substy t,Substable m s e a,Monad m) &#8658; s &#8688; t e &#8594; a &#8594; m a</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- msubstS = gsubstS return</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- </span><span>
</span><span id="line-27"></span><span class="hs-comment">-- msubst &#8759; (Substy t,Substable m () e a,Monad m) &#8658; t e &#8594; a &#8594; m a</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- msubst = msubstS &#8728; (&#8614;) ()</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- </span><span>
</span><span id="line-30"></span><span class="hs-comment">-- mrenameS &#8759; (Substy t,Substable m s e a,Monad m) &#8658; s &#8688; t Void &#8594; a &#8594; m a</span><span>
</span><span id="line-31"></span><span class="hs-comment">-- mrenameS = gsubstS exfalso</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- </span><span>
</span><span id="line-33"></span><span class="hs-comment">-- mrename &#8759; (Substy t,Substable m () e a,Monad m) &#8658; t Void &#8594; a &#8594; m a</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- mrename = mrenameS &#8728; (&#8614;) ()</span><span>
</span><span id="line-35"></span><span class="hs-comment">-- </span><span>
</span><span id="line-36"></span><span class="hs-comment">-- substS &#8759; (Substy t,Substable ID s a a) &#8658; s &#8688; t a &#8594; a &#8594; a</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- substS = unID &#8728;&#8728; msubstS</span><span>
</span><span id="line-38"></span><span class="hs-comment">-- </span><span>
</span><span id="line-39"></span><span class="hs-comment">-- subst &#8759; (Substy t,Substable ID () a a) &#8658; t a &#8594; a &#8594; a</span><span>
</span><span id="line-40"></span><span class="hs-comment">-- subst = substS &#8728; (&#8614;) ()</span><span>
</span><span id="line-41"></span><span class="hs-comment">-- </span><span>
</span><span id="line-42"></span><span class="hs-comment">-- renameS &#8759; (Substy t,Substable ID s e a) &#8658; s &#8688; t Void &#8594; a &#8594; a</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- renameS = unID &#8728;&#8728; mrenameS</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- </span><span>
</span><span id="line-45"></span><span class="hs-comment">-- rename &#8759; (Substy t,Substable ID () e a) &#8658; t Void &#8594; a &#8594; a</span><span>
</span><span id="line-46"></span><span class="hs-comment">-- rename = renameS &#8728; (&#8614;) ()</span><span>
</span><span id="line-47"></span><span class="hs-comment">-- </span><span>
</span><span id="line-48"></span><span class="hs-comment">-- (&#8904;) &#8759; (Substy t,Substable m () a a,Monad m) &#8658; t a &#8594; t a &#8594; m (t a)</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- (&#8904;) = &#120008;combine msubst</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- </span><span>
</span><span id="line-51"></span><span class="hs-comment">-- mcomposeSubs &#8759; (ToIter (t a) f,Substy t,Substable m () a a,Monad m) &#8658; f &#8594; m (t a)</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- mcomposeSubs = mfoldrFromWith null (&#8904;)</span><span>
</span><span id="line-53"></span><span class="hs-comment">-- </span><span>
</span><span id="line-54"></span><span class="hs-comment">-- ---------------</span><span>
</span><span id="line-55"></span><span class="hs-comment">-- -- Variables --</span><span>
</span><span id="line-56"></span><span class="hs-comment">-- ---------------</span><span>
</span><span id="line-57"></span><span class="hs-comment">-- </span><span>
</span><span id="line-58"></span><span class="hs-comment">-- &#120008;shiftVar &#8759; &#8469;64 &#8594; &#120144; &#8594; &#120144;</span><span>
</span><span id="line-59"></span><span class="hs-comment">-- &#120008;shiftVar n = \case</span><span>
</span><span id="line-60"></span><span class="hs-comment">--   NamedVar &#120013; &#8594; NamedVar &#120013;</span><span>
</span><span id="line-61"></span><span class="hs-comment">--   BoundVar &#120003; &#8594; BoundVar $ &#120003; + n</span><span>
</span><span id="line-62"></span><span class="hs-comment">-- </span><span>
</span><span id="line-63"></span><span class="hs-comment">-- grename &#8759; (Substy t,Monad m) &#8658; (a &#8594; m &#120144;) &#8594; t a &#8594; &#120144; &#8594; m &#120144;</span><span>
</span><span id="line-64"></span><span class="hs-comment">-- grename &#120011; &#120008; &#120014; = case &#120008;var &#120008; &#120014; of</span><span>
</span><span id="line-65"></span><span class="hs-comment">--   Inl &#120014;' &#8594; return &#120014;'</span><span>
</span><span id="line-66"></span><span class="hs-comment">--   Inr (&#120008;O :* e) &#8594; elim&#119874; return (grename exfalso) &#120008;O *$ &#120011; e</span><span>
</span><span id="line-67"></span><span class="hs-comment">-- </span><span>
</span><span id="line-68"></span><span class="hs-comment">-- instance Substable m () &#120144; &#120144; where gsubstS &#120011; &#120008; = grename &#120011; $ ifNone null $ &#120008; &#8917;? ()</span><span>
</span><span id="line-69"></span><span class="hs-comment">-- </span><span>
</span><span id="line-70"></span><span class="hs-comment">-- prandNVar &#8759; &#8469;64 &#8594; State RG &#120143;</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- prandNVar n&#738; = &#120143; &quot;x&quot; &#8728; Some ^$ prandr 0 n&#738;</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- </span><span>
</span><span id="line-73"></span><span class="hs-comment">-- prandBVar &#8759; &#8469;64 &#8594; &#8469;64 &#8594; State RG &#8469;64</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- prandBVar n&#738; n&#7495; = prandr 0 $ n&#7495; + n&#738;</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- </span><span>
</span><span id="line-76"></span><span class="hs-comment">-- prandVar &#8759; &#8469;64 &#8594; &#8469;64 &#8594; State RG &#120144;</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- prandVar n&#738; n&#7495; = mjoin $ prchoose</span><span>
</span><span id="line-78"></span><span class="hs-comment">--   [ \ () &#8594; NamedVar ^$ prandNVar n&#738;</span><span>
</span><span id="line-79"></span><span class="hs-comment">--   , \ () &#8594; BoundVar ^$ prandBVar n&#738; n&#7495;</span><span>
</span><span id="line-80"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- </span><span>
</span><span id="line-82"></span><span class="hs-comment">-- instance Rand &#120144; where prand n&#738; _n&#7496; = prandVar n&#738; zero</span><span>
</span><span id="line-83"></span><span class="hs-comment">-- </span><span>
</span><span id="line-84"></span><span class="hs-comment">-- ---------------------------</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- -- UNSCOPED SUBSTITUTION --</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- ---------------------------</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- </span><span>
</span><span id="line-88"></span><span class="hs-comment">-- newtype USubst a = USubst { unUSubst &#8759; &#120143; &#8688; a }</span><span>
</span><span id="line-89"></span><span class="hs-comment">--   deriving (Eq,Ord,Show,Pretty)</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- </span><span>
</span><span id="line-91"></span><span class="hs-comment">-- &#120008;ubind &#8759; &#120143; &#8688; a &#8594; USubst a</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- &#120008;ubind = USubst</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- </span><span>
</span><span id="line-94"></span><span class="hs-comment">-- &#120008;varUSubst &#8759; USubst a &#8594; &#120144; &#8594; &#120144; &#8744; a</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- &#120008;varUSubst &#120008; &#120014; = case &#120014; of</span><span>
</span><span id="line-96"></span><span class="hs-comment">--   NamedVar &#120013; | Some v &#8592; unUSubst &#120008; &#8917;? &#120013; &#8594; Inr v</span><span>
</span><span id="line-97"></span><span class="hs-comment">--   _ &#8594; Inl &#120014;</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- </span><span>
</span><span id="line-99"></span><span class="hs-comment">-- nullUSubst &#8759; USubst a</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- nullUSubst = USubst d&#248;</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- </span><span>
</span><span id="line-102"></span><span class="hs-comment">-- &#120008;combineUSubst &#8759; (Monad m) &#8658; (USubst a &#8594; b &#8594; m a) &#8594; USubst a &#8594; USubst b &#8594; m (USubst a)</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- &#120008;combineUSubst sub &#120008;&#8322; &#120008;&#8321; = USubst &#8728; dict ^$ exchange</span><span>
</span><span id="line-104"></span><span class="hs-comment">--   [ mapM (sub &#120008;&#8322;) $ unUSubst &#120008;&#8321;</span><span>
</span><span id="line-105"></span><span class="hs-comment">--   , return $ unUSubst &#120008;&#8322;</span><span>
</span><span id="line-106"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- </span><span>
</span><span id="line-108"></span><span class="hs-comment">-- appendUSubst &#8759; (Substable ID () a a) &#8658; USubst a &#8594; USubst a &#8594; USubst a</span><span>
</span><span id="line-109"></span><span class="hs-comment">-- appendUSubst = unID &#8728;&#8728; &#120008;combineUSubst msubst</span><span>
</span><span id="line-110"></span><span class="hs-comment">-- </span><span>
</span><span id="line-111"></span><span class="hs-comment">-- instance Substy USubst where</span><span>
</span><span id="line-112"></span><span class="hs-comment">--   &#120008;var &#120008; = mapInr (None :*) &#8728; &#120008;varUSubst &#120008;</span><span>
</span><span id="line-113"></span><span class="hs-comment">--   &#120008;shift = const id</span><span>
</span><span id="line-114"></span><span class="hs-comment">--   &#120008;combine = &#120008;combineUSubst</span><span>
</span><span id="line-115"></span><span class="hs-comment">-- </span><span>
</span><span id="line-116"></span><span class="hs-comment">-- usubst &#8759; (Substable ID () a a) &#8658; USubst a &#8594; a &#8594; a</span><span>
</span><span id="line-117"></span><span class="hs-comment">-- usubst = subst</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- </span><span>
</span><span id="line-119"></span><span class="hs-comment">-- musubst &#8759; (Substable m () e a,Monad m) &#8658; USubst e &#8594; a &#8594; m a</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- musubst = msubst</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- </span><span>
</span><span id="line-122"></span><span class="hs-comment">-- urename &#8759; (Substable ID () e a) &#8658; USubst Void &#8594; a &#8594; a</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- urename = rename</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- </span><span>
</span><span id="line-125"></span><span class="hs-comment">-- murename &#8759; (Substable m () e a,Monad m) &#8658; USubst Void &#8594; a &#8594; m a</span><span>
</span><span id="line-126"></span><span class="hs-comment">-- murename = mrename</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- </span><span>
</span><span id="line-128"></span><span class="hs-comment">-- instance Null (USubst a) where null = USubst d&#248;</span><span>
</span><span id="line-129"></span><span class="hs-comment">-- instance (Substable ID () a a) &#8658; Append (USubst a) where (&#10746;) = unID &#8728;&#8728; (&#8904;)</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- instance (Substable ID () a a) &#8658; Monoid (USubst a)</span><span>
</span><span id="line-131"></span><span class="hs-comment">-- </span><span>
</span><span id="line-132"></span><span class="hs-comment">-- prandUSubst &#8759; (Rand a) &#8658; &#8469;64 &#8594; &#8469;64 &#8594; State RG (USubst a)</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- prandUSubst n&#738; n&#7496; = USubst &#8728; dict ^$ mapMOn (upto n&#738;) $ const $ do</span><span>
</span><span id="line-134"></span><span class="hs-comment">--   x &#8592; prandNVar n&#738;</span><span>
</span><span id="line-135"></span><span class="hs-comment">--   v &#8592; prand n&#738; n&#7496;</span><span>
</span><span id="line-136"></span><span class="hs-comment">--   return $ x &#8614; v</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- </span><span>
</span><span id="line-138"></span><span class="hs-comment">-- instance (Rand a) &#8658;  Rand (USubst a) where prand = prandUSubst</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- </span><span>
</span><span id="line-140"></span><span class="hs-comment">-- -------------------------</span><span>
</span><span id="line-141"></span><span class="hs-comment">-- -- SCOPED SUBSTITUTION --</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- -------------------------</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- </span><span>
</span><span id="line-144"></span><span class="hs-comment">-- data SSubst a = SSubst</span><span>
</span><span id="line-145"></span><span class="hs-comment">--   { substShft &#8759; &#8469;64</span><span>
</span><span id="line-146"></span><span class="hs-comment">--   , substIncr &#8759; &#8484;64</span><span>
</span><span id="line-147"></span><span class="hs-comment">--   --               variable  term</span><span>
</span><span id="line-148"></span><span class="hs-comment">--   --               &#8595;         &#8595;</span><span>
</span><span id="line-149"></span><span class="hs-comment">--   , substBnvs &#8759; &#120141; (&#120144; &#8744; &#8469;64 &#8743; a)</span><span>
</span><span id="line-150"></span><span class="hs-comment">--   --                   &#8593;&#8593;&#8593; </span><span>
</span><span id="line-151"></span><span class="hs-comment">--   --                   shifted</span><span>
</span><span id="line-152"></span><span class="hs-comment">--   --                 variable  term</span><span>
</span><span id="line-153"></span><span class="hs-comment">--   --                 &#8595;         &#8595;</span><span>
</span><span id="line-154"></span><span class="hs-comment">--   , substNxvs &#8759; &#120143; &#8688; (&#120144; &#8744; &#8469;64 &#8743; a)</span><span>
</span><span id="line-155"></span><span class="hs-comment">--   --                     &#8593;&#8593;&#8593;</span><span>
</span><span id="line-156"></span><span class="hs-comment">--   --                     shifted</span><span>
</span><span id="line-157"></span><span class="hs-comment">--   } deriving (Eq,Ord,Show)</span><span>
</span><span id="line-158"></span><span class="hs-comment">-- makePrettyRecord ''SSubst</span><span>
</span><span id="line-159"></span><span class="hs-comment">-- </span><span>
</span><span id="line-160"></span><span class="hs-comment">-- &#120008;nvarSSubst &#8759; SSubst a &#8594; &#120143; &#8594; &#120144; &#8744; &#8469;64 &#8743; a</span><span>
</span><span id="line-161"></span><span class="hs-comment">-- &#120008;nvarSSubst (SSubst _&#961; _&#953; _bvs nvs) &#120013; = ifNone (Inl $ NamedVar &#120013;) $ nvs &#8917;? &#120013;</span><span>
</span><span id="line-162"></span><span class="hs-comment">-- </span><span>
</span><span id="line-163"></span><span class="hs-comment">-- &#120008;bvarSSubst &#8759; SSubst a &#8594; &#8469;64 &#8594; &#120144; &#8744; &#8469;64 &#8743; a</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- &#120008;bvarSSubst (SSubst &#961; &#953; bvs _nvs) &#120003; =</span><span>
</span><span id="line-165"></span><span class="hs-comment">--   if | &#120003; &lt; &#961; &#8594; Inl $ BoundVar &#120003;</span><span>
</span><span id="line-166"></span><span class="hs-comment">--      -- &#120003; &#8805; &#961;</span><span>
</span><span id="line-167"></span><span class="hs-comment">--      | &#120003; - &#961; &lt; csize bvs &#8594; bvs &#8917;! (&#120003; - &#961;)</span><span>
</span><span id="line-168"></span><span class="hs-comment">--      -- &#120003; &#8805; &#961; </span><span>
</span><span id="line-169"></span><span class="hs-comment">--      -- &#120003; - &#961; &lt; |bvs|</span><span>
</span><span id="line-170"></span><span class="hs-comment">--      | otherwise &#8594; Inl $ BoundVar $ nat&#937;64 $ int&#937;64 &#120003; + &#953;</span><span>
</span><span id="line-171"></span><span class="hs-comment">-- </span><span>
</span><span id="line-172"></span><span class="hs-comment">-- -- subst(&#961;,&#953;,bvs,nvs)(&#120014;) =</span><span>
</span><span id="line-173"></span><span class="hs-comment">-- --   &#120014;       if  &#120014; bound  and  &#120014; &lt; &#961;</span><span>
</span><span id="line-174"></span><span class="hs-comment">-- --   &#120014;+&#953;     if  &#120014; bound  and  &#120014; &#8805; &#961;  and  &#120014; - &#961; &#8805; |vs|</span><span>
</span><span id="line-175"></span><span class="hs-comment">-- --   bvs(&#120014;)  if  &#120014; bound  and  &#120014; &#8805; &#961;  and  &#120014; - &#961; &lt; |vs|</span><span>
</span><span id="line-176"></span><span class="hs-comment">-- --   nvs(&#120014;)  if  &#120014; named</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- &#120008;varSSubst &#8759; SSubst a &#8594; &#120144; &#8594; &#120144; &#8744; (&#8469;64 &#8743; a)</span><span>
</span><span id="line-178"></span><span class="hs-comment">-- &#120008;varSSubst &#120008; = \case</span><span>
</span><span id="line-179"></span><span class="hs-comment">--   NamedVar &#120003; &#8594; &#120008;nvarSSubst &#120008; &#120003;</span><span>
</span><span id="line-180"></span><span class="hs-comment">--   BoundVar &#120013; &#8594; &#120008;bvarSSubst &#120008; &#120013;</span><span>
</span><span id="line-181"></span><span class="hs-comment">-- </span><span>
</span><span id="line-182"></span><span class="hs-comment">-- wfSSubst &#8759; SSubst a &#8594; &#120121;</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- wfSSubst (SSubst _&#961; &#953; bvs _nvs) = and</span><span>
</span><span id="line-184"></span><span class="hs-comment">--   -- `|vs| + &#953;` should be non-negative</span><span>
</span><span id="line-185"></span><span class="hs-comment">--   [ int&#937;64 (csize bvs) + &#953; &#8805; 0</span><span>
</span><span id="line-186"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-187"></span><span class="hs-comment">-- </span><span>
</span><span id="line-188"></span><span class="hs-comment">-- -- subst(id)(&#120013;) = &#120013;</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- -- id &#8796; (0,&#8709;,0)</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- nullSSubst &#8759; SSubst a</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- nullSSubst = SSubst</span><span>
</span><span id="line-192"></span><span class="hs-comment">--   { substShft = 0</span><span>
</span><span id="line-193"></span><span class="hs-comment">--   , substIncr = 0</span><span>
</span><span id="line-194"></span><span class="hs-comment">--   , substBnvs = vec []</span><span>
</span><span id="line-195"></span><span class="hs-comment">--   , substNxvs = d&#248;</span><span>
</span><span id="line-196"></span><span class="hs-comment">--   }</span><span>
</span><span id="line-197"></span><span class="hs-comment">-- </span><span>
</span><span id="line-198"></span><span class="hs-comment">-- -- subst(intro)(&#120013;) = &#120013;+1</span><span>
</span><span id="line-199"></span><span class="hs-comment">-- -- intro &#8796; (0,&#8709;,1)</span><span>
</span><span id="line-200"></span><span class="hs-comment">-- &#120008;intro &#8759; &#8469;64 &#8594; SSubst a</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- &#120008;intro n = SSubst</span><span>
</span><span id="line-202"></span><span class="hs-comment">--   { substShft = 0</span><span>
</span><span id="line-203"></span><span class="hs-comment">--   , substIncr = int&#937;64 n</span><span>
</span><span id="line-204"></span><span class="hs-comment">--   , substBnvs = vec []</span><span>
</span><span id="line-205"></span><span class="hs-comment">--   , substNxvs = d&#248;</span><span>
</span><span id="line-206"></span><span class="hs-comment">--   }</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- </span><span>
</span><span id="line-208"></span><span class="hs-comment">-- -- subst(&#120008;shiftSSubst[n](&#961;,vs,&#953;))(&#120013;) = subst(&#961;,vs,&#953;)(&#120013;+n)</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- -- &#120008;shiftSSubst[n](&#961;,vs,&#953;) &#8796; (&#961;&#8242;,vs&#8242;,&#953;)</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- --   where</span><span>
</span><span id="line-211"></span><span class="hs-comment">-- --     &#961;&#8242; = &#961;+n</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- --     vs&#8242;(n&#8242;) = </span><span>
</span><span id="line-213"></span><span class="hs-comment">-- --       &#120013;+n       if  vs(n&#8242;) = &#120013;</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- --       (&#961;&#8337;+n,e)  if  vs(n&#8242;) = (&#961;&#8337;,e)</span><span>
</span><span id="line-215"></span><span class="hs-comment">-- &#120008;shiftSSubst &#8759; &#8469;64 &#8594; SSubst a &#8594; SSubst a</span><span>
</span><span id="line-216"></span><span class="hs-comment">-- &#120008;shiftSSubst n (SSubst &#961; &#953; bvs nvs) = </span><span>
</span><span id="line-217"></span><span class="hs-comment">--   let &#961;' = &#961; + n</span><span>
</span><span id="line-218"></span><span class="hs-comment">--       f = \case</span><span>
</span><span id="line-219"></span><span class="hs-comment">--         Inl &#120014; &#8594; Inl $ &#120008;shiftVar n &#120014;</span><span>
</span><span id="line-220"></span><span class="hs-comment">--         Inr (&#961;&#8337; :* e) &#8594; Inr $ (&#961;&#8337; + n) :* e</span><span>
</span><span id="line-221"></span><span class="hs-comment">--       bvs' = map f bvs</span><span>
</span><span id="line-222"></span><span class="hs-comment">--       nvs' = map f nvs</span><span>
</span><span id="line-223"></span><span class="hs-comment">--   in SSubst &#961;' &#953; bvs' nvs'</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- </span><span>
</span><span id="line-225"></span><span class="hs-comment">-- -- subst(bind(v))(&#120013;) =</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- --   v    if  &#120013; = 0</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- --   &#120013;-1  if  &#120013; &gt; 0</span><span>
</span><span id="line-228"></span><span class="hs-comment">-- -- bind(v) &#8796; (0,{0&#8614;v},-1)</span><span>
</span><span id="line-229"></span><span class="hs-comment">-- &#120008;bbind &#8759; a &#8594; SSubst a</span><span>
</span><span id="line-230"></span><span class="hs-comment">-- &#120008;bbind v = SSubst</span><span>
</span><span id="line-231"></span><span class="hs-comment">--   { substShft = 0</span><span>
</span><span id="line-232"></span><span class="hs-comment">--   , substIncr = neg 1</span><span>
</span><span id="line-233"></span><span class="hs-comment">--   , substBnvs = vec [Inr $ 0 :* v]</span><span>
</span><span id="line-234"></span><span class="hs-comment">--   , substNxvs = d&#248;</span><span>
</span><span id="line-235"></span><span class="hs-comment">--   }</span><span>
</span><span id="line-236"></span><span class="hs-comment">-- </span><span>
</span><span id="line-237"></span><span class="hs-comment">-- &#120008;nbind &#8759; &#120143; &#8688; a &#8594; SSubst a</span><span>
</span><span id="line-238"></span><span class="hs-comment">-- &#120008;nbind xvs = SSubst</span><span>
</span><span id="line-239"></span><span class="hs-comment">--   { substShft = 0</span><span>
</span><span id="line-240"></span><span class="hs-comment">--   , substIncr = 0</span><span>
</span><span id="line-241"></span><span class="hs-comment">--   , substBnvs = vec []</span><span>
</span><span id="line-242"></span><span class="hs-comment">--   , substNxvs = map (Inr &#8728; (0 :*)) xvs</span><span>
</span><span id="line-243"></span><span class="hs-comment">--   }</span><span>
</span><span id="line-244"></span><span class="hs-comment">-- </span><span>
</span><span id="line-245"></span><span class="hs-comment">-- &#120008;open &#8759; &#120143; &#8594; SSubst a</span><span>
</span><span id="line-246"></span><span class="hs-comment">-- &#120008;open &#120013; = SSubst</span><span>
</span><span id="line-247"></span><span class="hs-comment">--   { substShft = 0</span><span>
</span><span id="line-248"></span><span class="hs-comment">--   , substIncr = neg 1</span><span>
</span><span id="line-249"></span><span class="hs-comment">--   , substBnvs = vec [Inl $ NamedVar &#120013;]</span><span>
</span><span id="line-250"></span><span class="hs-comment">--   , substNxvs = d&#248;</span><span>
</span><span id="line-251"></span><span class="hs-comment">--   }</span><span>
</span><span id="line-252"></span><span class="hs-comment">-- </span><span>
</span><span id="line-253"></span><span class="hs-comment">-- &#120008;close &#8759; &#120143; &#8594; SSubst a</span><span>
</span><span id="line-254"></span><span class="hs-comment">-- &#120008;close &#120013; = SSubst</span><span>
</span><span id="line-255"></span><span class="hs-comment">--   { substShft = 0</span><span>
</span><span id="line-256"></span><span class="hs-comment">--   , substIncr = 1</span><span>
</span><span id="line-257"></span><span class="hs-comment">--   , substBnvs = vec []</span><span>
</span><span id="line-258"></span><span class="hs-comment">--   , substNxvs = &#120013; &#8614; Inl (BoundVar 0)</span><span>
</span><span id="line-259"></span><span class="hs-comment">--   }</span><span>
</span><span id="line-260"></span><span class="hs-comment">-- </span><span>
</span><span id="line-261"></span><span class="hs-comment">-- &#120008;combineSSubst &#8759; (Monad m) &#8658; (SSubst a &#8594; b &#8594; m a) &#8594; SSubst a &#8594; SSubst b &#8594; m (SSubst a)</span><span>
</span><span id="line-262"></span><span class="hs-comment">-- &#120008;combineSSubst sub &#120008;&#8322;@(SSubst &#961;&#8322; &#953;&#8322; bvs&#8322; nvs&#8322;) (SSubst &#961;&#8321; &#953;&#8321; bvs&#8321; nvs&#8321;) = do</span><span>
</span><span id="line-263"></span><span class="hs-comment">--   let &#961; = &#961;&#8321; &#8851; &#961;&#8322;</span><span>
</span><span id="line-264"></span><span class="hs-comment">--       logicalSize = nat&#937;64 $ joins</span><span>
</span><span id="line-265"></span><span class="hs-comment">--         [ int&#937;64 $ csize bvs&#8321; + &#961;&#8321;</span><span>
</span><span id="line-266"></span><span class="hs-comment">--         , int&#937;64 (csize bvs&#8322;) + int&#937;64 &#961;&#8322; - &#953;&#8321;</span><span>
</span><span id="line-267"></span><span class="hs-comment">--         ]</span><span>
</span><span id="line-268"></span><span class="hs-comment">--       vsSize = logicalSize - &#961;</span><span>
</span><span id="line-269"></span><span class="hs-comment">--       vsOffset&#8321; = &#961;&#8321; - &#961;</span><span>
</span><span id="line-270"></span><span class="hs-comment">--       &#953; = &#953;&#8321; + &#953;&#8322;</span><span>
</span><span id="line-271"></span><span class="hs-comment">--   bvs &#8592; exchange $ vecF vsSize $ \ &#120013; &#8594; </span><span>
</span><span id="line-272"></span><span class="hs-comment">--         if &#120013; &lt; vsOffset&#8321;</span><span>
</span><span id="line-273"></span><span class="hs-comment">--         then return $ &#120008;bvarSSubst &#120008;&#8322; $ &#961; + &#120013;</span><span>
</span><span id="line-274"></span><span class="hs-comment">--         else</span><span>
</span><span id="line-275"></span><span class="hs-comment">--           case bvs&#8321; &#8917;? (&#120013; - vsOffset&#8321;) of</span><span>
</span><span id="line-276"></span><span class="hs-comment">--             Some v &#8594; case v of</span><span>
</span><span id="line-277"></span><span class="hs-comment">--               Inl &#120014; &#8594; return $ &#120008;varSSubst &#120008;&#8322; &#120014;</span><span>
</span><span id="line-278"></span><span class="hs-comment">--               Inr (&#961;&#8337; :* e) &#8594; do</span><span>
</span><span id="line-279"></span><span class="hs-comment">--                 &#120008; &#8592; &#120008;combineSSubst sub &#120008;&#8322; $ &#120008;intro &#961;&#8337;</span><span>
</span><span id="line-280"></span><span class="hs-comment">--                 Inr &#8728; (0 :*) ^$ sub &#120008; e</span><span>
</span><span id="line-281"></span><span class="hs-comment">--             None &#8594; return $ &#120008;bvarSSubst &#120008;&#8322; $ nat&#937;64 $ int&#937;64 (&#961; + &#120013;) + &#953;&#8321;</span><span>
</span><span id="line-282"></span><span class="hs-comment">--   nvs &#8592; dict ^$ exchange</span><span>
</span><span id="line-283"></span><span class="hs-comment">--     [ mapMOn nvs&#8321; $ \case</span><span>
</span><span id="line-284"></span><span class="hs-comment">--         Inl &#120014; &#8594; return $ &#120008;varSSubst &#120008;&#8322; &#120014;</span><span>
</span><span id="line-285"></span><span class="hs-comment">--         Inr (&#961;&#8337; :* e) &#8594; do</span><span>
</span><span id="line-286"></span><span class="hs-comment">--           &#120008; &#8592; &#120008;combineSSubst sub &#120008;&#8322; $ &#120008;intro &#961;&#8337;</span><span>
</span><span id="line-287"></span><span class="hs-comment">--           (Inr &#8728; (0 :*)) ^$ sub &#120008; e</span><span>
</span><span id="line-288"></span><span class="hs-comment">--     , return nvs&#8322;</span><span>
</span><span id="line-289"></span><span class="hs-comment">--     ]</span><span>
</span><span id="line-290"></span><span class="hs-comment">--   return $ SSubst &#961; &#953; bvs nvs</span><span>
</span><span id="line-291"></span><span class="hs-comment">-- </span><span>
</span><span id="line-292"></span><span class="hs-comment">-- appendSubst &#8759; (Substable ID () a a) &#8658; SSubst a &#8594; SSubst a &#8594; SSubst a</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- appendSubst = unID &#8728;&#8728; &#120008;combineSSubst msubst</span><span>
</span><span id="line-294"></span><span class="hs-comment">-- </span><span>
</span><span id="line-295"></span><span class="hs-comment">-- instance Substy SSubst where</span><span>
</span><span id="line-296"></span><span class="hs-comment">--   &#120008;var &#120008; = mapInr (mapFst $ Some &#8728; &#120008;intro) &#8728; &#120008;varSSubst &#120008;</span><span>
</span><span id="line-297"></span><span class="hs-comment">--   &#120008;shift = &#120008;shiftSSubst</span><span>
</span><span id="line-298"></span><span class="hs-comment">--   &#120008;combine = &#120008;combineSSubst</span><span>
</span><span id="line-299"></span><span class="hs-comment">-- </span><span>
</span><span id="line-300"></span><span class="hs-comment">-- ssubst &#8759; (Substable ID () a a) &#8658; SSubst a &#8594; a &#8594; a</span><span>
</span><span id="line-301"></span><span class="hs-comment">-- ssubst = subst</span><span>
</span><span id="line-302"></span><span class="hs-comment">-- </span><span>
</span><span id="line-303"></span><span class="hs-comment">-- mssubst &#8759; (Substable m () e a,Monad m) &#8658; SSubst e &#8594; a &#8594; m a</span><span>
</span><span id="line-304"></span><span class="hs-comment">-- mssubst = msubst</span><span>
</span><span id="line-305"></span><span class="hs-comment">-- </span><span>
</span><span id="line-306"></span><span class="hs-comment">-- srename &#8759; (Substable ID () e a) &#8658; SSubst Void &#8594; a &#8594; a</span><span>
</span><span id="line-307"></span><span class="hs-comment">-- srename = rename</span><span>
</span><span id="line-308"></span><span class="hs-comment">-- </span><span>
</span><span id="line-309"></span><span class="hs-comment">-- msrename &#8759; (Substable m () e a,Monad m) &#8658; SSubst Void &#8594; a &#8594; m a</span><span>
</span><span id="line-310"></span><span class="hs-comment">-- msrename = mrename</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- </span><span>
</span><span id="line-312"></span><span class="hs-comment">-- instance Null (SSubst a) where null = nullSSubst</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- instance (Substable ID () a a) &#8658; Append (SSubst a) where (&#10746;) = unID &#8728;&#8728; (&#8904;)</span><span>
</span><span id="line-314"></span><span class="hs-comment">-- instance (Substable ID () a a) &#8658; Monoid (SSubst a)</span><span>
</span><span id="line-315"></span><span class="hs-comment">-- </span><span>
</span><span id="line-316"></span><span class="hs-comment">-- prandSSubst &#8759; (Rand a) &#8658; &#8469;64 &#8594; &#8469;64 &#8594; State RG (SSubst a)</span><span>
</span><span id="line-317"></span><span class="hs-comment">-- prandSSubst n&#738; n&#7496; = do</span><span>
</span><span id="line-318"></span><span class="hs-comment">--   &#961; &#8592; prandr zero n&#738;</span><span>
</span><span id="line-319"></span><span class="hs-comment">--   vsSize &#8592; prandr zero n&#738;</span><span>
</span><span id="line-320"></span><span class="hs-comment">--   &#953; &#8592; prandr (neg $ int&#937;64 vsSize) $ int&#937;64 n&#738;</span><span>
</span><span id="line-321"></span><span class="hs-comment">--   bvs &#8592; mapMOn (vecF vsSize id) $ const $ prandChoice (const &#8728; flip prand zero) prand n&#738; n&#7496;</span><span>
</span><span id="line-322"></span><span class="hs-comment">--   nvs &#8592; dict ^$ mapMOn (upto n&#738;) $ const $ do</span><span>
</span><span id="line-323"></span><span class="hs-comment">--     x &#8592; prandNVar n&#738;</span><span>
</span><span id="line-324"></span><span class="hs-comment">--     v &#8592; prand n&#738; n&#7496;</span><span>
</span><span id="line-325"></span><span class="hs-comment">--     return $ x &#8614; v</span><span>
</span><span id="line-326"></span><span class="hs-comment">--   return $ SSubst &#961; &#953; bvs nvs</span><span>
</span><span id="line-327"></span><span class="hs-comment">-- </span><span>
</span><span id="line-328"></span><span class="hs-comment">-- instance (Rand a) &#8658;  Rand (SSubst a) where prand = prandSSubst</span><span>
</span><span id="line-329"></span><span class="hs-comment">-- </span><span>
</span><span id="line-330"></span><span class="hs-comment">-- --------------------</span><span>
</span><span id="line-331"></span><span class="hs-comment">-- -- RENAMING MONAD --</span><span>
</span><span id="line-332"></span><span class="hs-comment">-- --------------------</span><span>
</span><span id="line-333"></span><span class="hs-comment">-- </span><span>
</span><span id="line-334"></span><span class="hs-comment">-- newtype RenameM s a = RenameM { unRenameM &#8759; UContT ((&#8594;) (s &#8688; SSubst Void)) a }</span><span>
</span><span id="line-335"></span><span class="hs-comment">--   deriving</span><span>
</span><span id="line-336"></span><span class="hs-comment">--   ( Return,Bind,Functor,Monad</span><span>
</span><span id="line-337"></span><span class="hs-comment">--   , MonadReader (s &#8688; SSubst Void)</span><span>
</span><span id="line-338"></span><span class="hs-comment">--   , MonadUCont</span><span>
</span><span id="line-339"></span><span class="hs-comment">--   )</span><span>
</span><span id="line-340"></span><span class="hs-comment">-- </span><span>
</span><span id="line-341"></span><span class="hs-comment">-- runRenameM &#8759; s &#8688; SSubst Void &#8594; RenameM s a &#8594; a</span><span>
</span><span id="line-342"></span><span class="hs-comment">-- runRenameM &#120008; = appto &#120008; &#8728; evalUContT &#8728; unRenameM</span><span>
</span><span id="line-343"></span><span class="hs-comment">-- </span><span>
</span><span id="line-344"></span><span class="hs-comment">-- evalRenameM &#8759; RenameM s a &#8594; a</span><span>
</span><span id="line-345"></span><span class="hs-comment">-- evalRenameM = runRenameM null</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- </span><span>
</span><span id="line-347"></span><span class="hs-comment">-- ppVarScoped &#8759; (Ord s) &#8658; s &#8594; &#120144; &#8594; RenameM s Doc</span><span>
</span><span id="line-348"></span><span class="hs-comment">-- ppVarScoped s &#120014; = do</span><span>
</span><span id="line-349"></span><span class="hs-comment">--   &#120008; &#8592; ask</span><span>
</span><span id="line-350"></span><span class="hs-comment">--   let &#120014;' = elim&#119874; id rename (&#120008; &#8917;? s) &#120014;</span><span>
</span><span id="line-351"></span><span class="hs-comment">--   return $ concat</span><span>
</span><span id="line-352"></span><span class="hs-comment">--     [ pretty &#120014;'</span><span>
</span><span id="line-353"></span><span class="hs-comment">--     , if &#120014;' &#8801; &#120014; </span><span>
</span><span id="line-354"></span><span class="hs-comment">--       then null</span><span>
</span><span id="line-355"></span><span class="hs-comment">--       else concat</span><span>
</span><span id="line-356"></span><span class="hs-comment">--         [ ppPun &quot;&#171;&quot;</span><span>
</span><span id="line-357"></span><span class="hs-comment">--         , pretty &#120014;</span><span>
</span><span id="line-358"></span><span class="hs-comment">--         , ppPun &quot;&#187;&quot;</span><span>
</span><span id="line-359"></span><span class="hs-comment">--         ]</span><span>
</span><span id="line-360"></span><span class="hs-comment">--     ]</span><span>
</span><span id="line-361"></span><span class="hs-comment">-- </span><span>
</span><span id="line-362"></span><span class="hs-comment">-- -- --------------</span><span>
</span><span id="line-363"></span><span class="hs-comment">-- -- -- FOR ULCD --</span><span>
</span><span id="line-364"></span><span class="hs-comment">-- -- --------------</span><span>
</span><span id="line-365"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-366"></span><span class="hs-comment">-- -- gsubstULCD &#8759; (Substy t,Monad m) &#8658; (a &#8594; m (ULCDExp &#119992;)) &#8594; t a &#8594; ULCDExp &#119992; &#8594; m (ULCDExp &#119992;)</span><span>
</span><span id="line-367"></span><span class="hs-comment">-- -- gsubstULCD &#120011; &#120008; (ULCDExp (&#119860; &#119992; e&#8320;)) = case e&#8320; of</span><span>
</span><span id="line-368"></span><span class="hs-comment">-- --   Var_ULCD x &#8594; case &#120008;var &#120008; x of</span><span>
</span><span id="line-369"></span><span class="hs-comment">-- --     Inl x' &#8594; return $ ULCDExp $ &#119860; &#119992; $ Var_ULCD x'</span><span>
</span><span id="line-370"></span><span class="hs-comment">-- --     Inr (&#120008;O :* e) &#8594; elim&#119874; return (gsubstULCD exfalso) &#120008;O *$ &#120011; e</span><span>
</span><span id="line-371"></span><span class="hs-comment">-- --   Lam_ULCD e &#8594; do</span><span>
</span><span id="line-372"></span><span class="hs-comment">-- --     e' &#8592; gsubstULCD &#120011; (&#120008;shift 1 &#120008;) e</span><span>
</span><span id="line-373"></span><span class="hs-comment">-- --     return $ ULCDExp $ &#119860; &#119992; $ Lam_ULCD e'</span><span>
</span><span id="line-374"></span><span class="hs-comment">-- --   App_ULCD e&#8321; e&#8322; &#8594; do</span><span>
</span><span id="line-375"></span><span class="hs-comment">-- --     e&#8321;' &#8592; gsubstULCD &#120011; &#120008; e&#8321;</span><span>
</span><span id="line-376"></span><span class="hs-comment">-- --     e&#8322;' &#8592; gsubstULCD &#120011; &#120008; e&#8322;</span><span>
</span><span id="line-377"></span><span class="hs-comment">-- --     return $ ULCDExp $ &#119860; &#119992; $ App_ULCD e&#8321;' e&#8322;'</span><span>
</span><span id="line-378"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-379"></span><span class="hs-comment">-- -- instance Substable m () (ULCDExp &#119992;) (ULCDExp &#119992;) where gsubstS &#120011; &#120008; = gsubstULCD &#120011; $ ifNone null $ &#120008; &#8917;? ()</span><span>
</span><span id="line-380"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-381"></span><span class="hs-comment">-- -- prandULCDExp &#8759; &#8469;64 &#8594; &#8469;64 &#8594; &#8469;64 &#8594; State RG ULCDExpR</span><span>
</span><span id="line-382"></span><span class="hs-comment">-- -- prandULCDExp n&#738; n&#7495; n&#7496; = ULCDExp &#8728; &#119860; () ^$ mjoin $ prwchoose</span><span>
</span><span id="line-383"></span><span class="hs-comment">-- --     [ (2 :*) $ \ () &#8594; do</span><span>
</span><span id="line-384"></span><span class="hs-comment">-- --         Var_ULCD ^$ prandVar n&#738; n&#7495;</span><span>
</span><span id="line-385"></span><span class="hs-comment">-- --     , (n&#7496; :*) $ \ () &#8594; do</span><span>
</span><span id="line-386"></span><span class="hs-comment">-- --         Lam_ULCD ^$ prandULCDExp n&#738; (n&#7495; + 1) $ n&#7496; - 1</span><span>
</span><span id="line-387"></span><span class="hs-comment">-- --     , (n&#7496; :*) $ \ () &#8594; do</span><span>
</span><span id="line-388"></span><span class="hs-comment">-- --         e&#8321; &#8592; prandULCDExp n&#738; n&#7495; $ n&#7496; - 1</span><span>
</span><span id="line-389"></span><span class="hs-comment">-- --         e&#8322; &#8592; prandULCDExp n&#738; n&#7495; $ n&#7496; - 1</span><span>
</span><span id="line-390"></span><span class="hs-comment">-- --         return $ App_ULCD e&#8321; e&#8322;</span><span>
</span><span id="line-391"></span><span class="hs-comment">-- --     ]</span><span>
</span><span id="line-392"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-393"></span><span class="hs-comment">-- -- instance Rand ULCDExpR where prand = flip prandULCDExp zero</span><span>
</span><span id="line-394"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-395"></span><span class="hs-comment">-- -- {-</span><span>
</span><span id="line-396"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-397"></span><span class="hs-comment">-- -- -----------</span><span>
</span><span id="line-398"></span><span class="hs-comment">-- -- -- TESTS --</span><span>
</span><span id="line-399"></span><span class="hs-comment">-- -- -----------</span><span>
</span><span id="line-400"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-401"></span><span class="hs-comment">-- -- -- basic --</span><span>
</span><span id="line-402"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-403"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:id&quot; [| ssubst null [ulcd| &#955; &#8594; 0   |] |] [| [ulcd| &#955; &#8594; 0   |] |]</span><span>
</span><span id="line-404"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:id&quot; [| ssubst null [ulcd| &#955; &#8594; 1   |] |] [| [ulcd| &#955; &#8594; 1   |] |]</span><span>
</span><span id="line-405"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:id&quot; [| ssubst null [ulcd| &#955; &#8594; 2   |] |] [| [ulcd| &#955; &#8594; 2   |] |]</span><span>
</span><span id="line-406"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:id&quot; [| ssubst null [ulcd| &#955; &#8594; 0 2 |] |] [| [ulcd| &#955; &#8594; 0 2 |] |]</span><span>
</span><span id="line-407"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-408"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:intro&quot; [| ssubst (&#120008;intro 1) [ulcd| &#955; &#8594; 0   |] |] [| [ulcd| &#955; &#8594; 0   |] |]</span><span>
</span><span id="line-409"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:intro&quot; [| ssubst (&#120008;intro 1) [ulcd| &#955; &#8594; 1   |] |] [| [ulcd| &#955; &#8594; 2   |] |]</span><span>
</span><span id="line-410"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:intro&quot; [| ssubst (&#120008;intro 1) [ulcd| &#955; &#8594; 2   |] |] [| [ulcd| &#955; &#8594; 3   |] |]</span><span>
</span><span id="line-411"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:intro&quot; [| ssubst (&#120008;intro 1) [ulcd| &#955; &#8594; 0 2 |] |] [| [ulcd| &#955; &#8594; 0 3 |] |]</span><span>
</span><span id="line-412"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-413"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:intro&quot; [| ssubst (&#120008;intro 2) [ulcd| &#955; &#8594; 0   |] |] [| [ulcd| &#955; &#8594; 0   |] |]</span><span>
</span><span id="line-414"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:intro&quot; [| ssubst (&#120008;intro 2) [ulcd| &#955; &#8594; 1   |] |] [| [ulcd| &#955; &#8594; 3   |] |]</span><span>
</span><span id="line-415"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:intro&quot; [| ssubst (&#120008;intro 2) [ulcd| &#955; &#8594; 2   |] |] [| [ulcd| &#955; &#8594; 4   |] |]</span><span>
</span><span id="line-416"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:intro&quot; [| ssubst (&#120008;intro 2) [ulcd| &#955; &#8594; 0 2 |] |] [| [ulcd| &#955; &#8594; 0 4 |] |]</span><span>
</span><span id="line-417"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-418"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:bind&quot; [| subst (&#120008;bbind [ulcd| &#955; &#8594; 0 |]) [ulcd| &#955; &#8594; 0 |] |] [| [ulcd| &#955; &#8594; 0     |] |]</span><span>
</span><span id="line-419"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:bind&quot; [| subst (&#120008;bbind [ulcd| &#955; &#8594; 1 |]) [ulcd| &#955; &#8594; 0 |] |] [| [ulcd| &#955; &#8594; 0     |] |]</span><span>
</span><span id="line-420"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:bind&quot; [| subst (&#120008;bbind [ulcd| &#955; &#8594; 0 |]) [ulcd| &#955; &#8594; 1 |] |] [| [ulcd| &#955; &#8594; &#955; &#8594; 0 |] |]</span><span>
</span><span id="line-421"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:bind&quot; [| subst (&#120008;bbind [ulcd| &#955; &#8594; 1 |]) [ulcd| &#955; &#8594; 1 |] |] [| [ulcd| &#955; &#8594; &#955; &#8594; 2 |] |]</span><span>
</span><span id="line-422"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-423"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:shift&quot; [| subst (&#120008;shift 1 $ &#120008;bbind [ulcd| &#955; &#8594; 0 |]) [ulcd| &#955; &#8594; 0 |] |] </span><span>
</span><span id="line-424"></span><span class="hs-comment">-- --                  [| [ulcd| &#955; &#8594; 0 |] |]</span><span>
</span><span id="line-425"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:shift&quot; [| subst (&#120008;shift 1 $ &#120008;bbind [ulcd| &#955; &#8594; 1 |]) [ulcd| &#955; &#8594; 0 |] |] </span><span>
</span><span id="line-426"></span><span class="hs-comment">-- --                  [| [ulcd| &#955; &#8594; 0 |] |]</span><span>
</span><span id="line-427"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:shift&quot; [| subst (&#120008;shift 1 $ &#120008;bbind [ulcd| &#955; &#8594; 0 |]) [ulcd| &#955; &#8594; 1 |] |] </span><span>
</span><span id="line-428"></span><span class="hs-comment">-- --                  [| [ulcd| &#955; &#8594; 1 |] |]</span><span>
</span><span id="line-429"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:shift&quot; [| subst (&#120008;shift 1 $ &#120008;bbind [ulcd| &#955; &#8594; 1 |]) [ulcd| &#955; &#8594; 1 |] |] </span><span>
</span><span id="line-430"></span><span class="hs-comment">-- --                  [| [ulcd| &#955; &#8594; 1 |] |]</span><span>
</span><span id="line-431"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:shift&quot; [| subst (&#120008;shift 1 $ &#120008;bbind [ulcd| &#955; &#8594; 2 |]) [ulcd| &#955; &#8594; 0 |] |] </span><span>
</span><span id="line-432"></span><span class="hs-comment">-- --                  [| [ulcd| &#955; &#8594; 0 |] |]</span><span>
</span><span id="line-433"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:shift&quot; [| subst (&#120008;shift 1 $ &#120008;bbind [ulcd| &#955; &#8594; 2 |]) [ulcd| &#955; &#8594; 1 |] |] </span><span>
</span><span id="line-434"></span><span class="hs-comment">-- --                  [| [ulcd| &#955; &#8594; 1 |] |]</span><span>
</span><span id="line-435"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:shift&quot; [| subst (&#120008;shift 1 $ &#120008;bbind [ulcd| &#955; &#8594; 1 |]) [ulcd| &#955; &#8594; 2 |] |] </span><span>
</span><span id="line-436"></span><span class="hs-comment">-- --                  [| [ulcd| &#955; &#8594; &#955; &#8594; 3 |] |]</span><span>
</span><span id="line-437"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:shift&quot; [| subst (&#120008;shift 1 $ &#120008;bbind [ulcd| &#955; &#8594; 2 |]) [ulcd| &#955; &#8594; 2 |] |] </span><span>
</span><span id="line-438"></span><span class="hs-comment">-- --                  [| [ulcd| &#955; &#8594; &#955; &#8594; 4 |] |]</span><span>
</span><span id="line-439"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-440"></span><span class="hs-comment">-- -- -- append --</span><span>
</span><span id="line-441"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-442"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:&#10746;&quot; [| ssubst null            [ulcd| &#955; &#8594; 0 |] |] [| [ulcd| &#955; &#8594; 0 |] |]</span><span>
</span><span id="line-443"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:&#10746;&quot; [| ssubst (null &#10746; null)   [ulcd| &#955; &#8594; 0 |] |] [| [ulcd| &#955; &#8594; 0 |] |]</span><span>
</span><span id="line-444"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:&#10746;&quot; [| ssubst (&#120008;shift 1 null) [ulcd| &#955; &#8594; 0 |] |] [| [ulcd| &#955; &#8594; 0 |] |]</span><span>
</span><span id="line-445"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:&#10746;&quot; [| ssubst (&#120008;shift 2 null) [ulcd| &#955; &#8594; 0 |] |] [| [ulcd| &#955; &#8594; 0 |] |]</span><span>
</span><span id="line-446"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-447"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:&#10746;&quot; [| ssubst null          [ulcd| &#955; &#8594; 1 |] |] [| [ulcd| &#955; &#8594; 1 |] |]</span><span>
</span><span id="line-448"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:&#10746;&quot; [| ssubst (null &#10746; null) [ulcd| &#955; &#8594; 1 |] |] [| [ulcd| &#955; &#8594; 1 |] |]</span><span>
</span><span id="line-449"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-450"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:&#10746;&quot; [| ssubst (&#120008;intro 1)               [ulcd| &#955; &#8594; 0 |] |] [| [ulcd| &#955; &#8594; 0 |] |]</span><span>
</span><span id="line-451"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:&#10746;&quot; [| ssubst (null &#10746; &#120008;intro 1 &#10746; null) [ulcd| &#955; &#8594; 0 |] |] [| [ulcd| &#955; &#8594; 0 |] |]</span><span>
</span><span id="line-452"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-453"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:&#10746;&quot; [| ssubst (&#120008;intro 1)               [ulcd| &#955; &#8594; 1 |] |] [| [ulcd| &#955; &#8594; 2 |] |]</span><span>
</span><span id="line-454"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:&#10746;&quot; [| ssubst (null &#10746; &#120008;intro 1 &#10746; null) [ulcd| &#955; &#8594; 1 |] |] [| [ulcd| &#955; &#8594; 2 |] |]</span><span>
</span><span id="line-455"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-456"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:&#10746;&quot; [| ssubst (&#120008;bbind [ulcd| &#955; &#8594; 0 |]) [ulcd| &#955; &#8594; 1 |] |] </span><span>
</span><span id="line-457"></span><span class="hs-comment">-- --              [| [ulcd| &#955; &#8594; &#955; &#8594; 0 |] |]</span><span>
</span><span id="line-458"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:&#10746;&quot; [| ssubst (null &#10746; &#120008;bbind [ulcd| &#955; &#8594; 0 |] &#10746; null) [ulcd| &#955; &#8594; 1 |] |] </span><span>
</span><span id="line-459"></span><span class="hs-comment">-- --              [| [ulcd| &#955; &#8594; &#955; &#8594; 0 |] |]</span><span>
</span><span id="line-460"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-461"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:&#10746;&quot; [| ssubst (&#120008;intro 2) [ulcd| &#955; &#8594; 1 |] |]            [| [ulcd| &#955; &#8594; 3 |] |]</span><span>
</span><span id="line-462"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:&#10746;&quot; [| ssubst (&#120008;intro 1 &#10746; &#120008;intro 1) [ulcd| &#955; &#8594; 1 |] |] [| [ulcd| &#955; &#8594; 3 |] |]</span><span>
</span><span id="line-463"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-464"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:&#10746;&quot; [| ssubst (&#120008;bbind [ulcd| &#955; &#8594; 0 |]) [ulcd| &#955; &#8594; 1 |] |] </span><span>
</span><span id="line-465"></span><span class="hs-comment">-- --              [| [ulcd| &#955; &#8594; &#955; &#8594; 0 |] |]</span><span>
</span><span id="line-466"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:&#10746;&quot; [| ssubst (&#120008;shift 1 (&#120008;bbind [ulcd| &#955; &#8594; 0 |]) &#10746; &#120008;intro 1) [ulcd| &#955; &#8594; 1 |] |] </span><span>
</span><span id="line-467"></span><span class="hs-comment">-- --              [| [ulcd| &#955; &#8594; &#955; &#8594; 0 |] |]</span><span>
</span><span id="line-468"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-469"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:&#10746;&quot; [| ssubst (&#120008;intro 1 &#10746; &#120008;bbind [ulcd| 1 |]) [ulcd| 0 (&#955; &#8594; 2) |] |] </span><span>
</span><span id="line-470"></span><span class="hs-comment">-- --              [| [ulcd| 2 (&#955; &#8594; 2) |] |]</span><span>
</span><span id="line-471"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:&#10746;&quot; [| ssubst (&#120008;shift 1 (&#120008;bbind [ulcd| 1 |]) &#10746; &#120008;intro 1) [ulcd| 0 (&#955; &#8594; 2) |] |] </span><span>
</span><span id="line-472"></span><span class="hs-comment">-- --              [| [ulcd| 2 (&#955; &#8594; 2) |] |]</span><span>
</span><span id="line-473"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-474"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:&#10746;&quot; [| ssubst (&#120008;intro 1) (ssubst (&#120008;shift 1 null) [ulcd| 0 |]) |]</span><span>
</span><span id="line-475"></span><span class="hs-comment">-- --              [| ssubst (&#120008;intro 1 &#10746; &#120008;shift 1 null) [ulcd| 0 |] |]</span><span>
</span><span id="line-476"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-477"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:&#10746;&quot; [| ssubst (&#120008;bbind [ulcd| 1 |]) (ssubst (&#120008;shift 1 (&#120008;intro 1)) [ulcd| 0 |]) |]</span><span>
</span><span id="line-478"></span><span class="hs-comment">-- --              [| ssubst (&#120008;bbind [ulcd| 1 |] &#10746; &#120008;shift 1 (&#120008;intro 1)) [ulcd| 0 |] |]</span><span>
</span><span id="line-479"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-480"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:&#10746;&quot; [| ssubst (&#120008;shift 1 (&#120008;bbind [ulcd| 1 |])) (ssubst (&#120008;shift 1 null) [ulcd| 1 |]) |]</span><span>
</span><span id="line-481"></span><span class="hs-comment">-- --              [| ssubst (&#120008;shift 1 (&#120008;bbind [ulcd| 1 |]) &#10746; &#120008;shift 1 null) [ulcd| 1 |] |]</span><span>
</span><span id="line-482"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-483"></span><span class="hs-comment">-- -- -- unscoped --</span><span>
</span><span id="line-484"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-485"></span><span class="hs-comment">-- -- &#120113; &quot;usubst:bind&quot; [| usubst (&#120008;ubind $ var &quot;x&quot; &#8614; [ulcd| 0 |]) [ulcd| x     |] |] [| [ulcd| 0     |] |]</span><span>
</span><span id="line-486"></span><span class="hs-comment">-- -- &#120113; &quot;usubst:bind&quot; [| usubst (&#120008;ubind $ var &quot;x&quot; &#8614; [ulcd| 0 |]) [ulcd| &#955; &#8594; x |] |] [| [ulcd| &#955; &#8594; 0 |] |]</span><span>
</span><span id="line-487"></span><span class="hs-comment">-- -- &#120113; &quot;ssubst:bind&quot; [| ssubst (&#120008;nbind $ var &quot;x&quot; &#8614; [ulcd| 0 |]) [ulcd| &#955; &#8594; x |] |] [| [ulcd| &#955; &#8594; 1 |] |]</span><span>
</span><span id="line-488"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-489"></span><span class="hs-comment">-- -- -- fuzzing --</span><span>
</span><span id="line-490"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-491"></span><span class="hs-comment">-- -- &#120099; &quot;zzz:ssubst:wf&quot; 100 [| randSml @(SSubst ULCDExpR) |] [| wfSSubst |]</span><span>
</span><span id="line-492"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-493"></span><span class="hs-comment">-- -- &#120099; &quot;zzz:ssubst:&#10746;:wf&quot; 100 </span><span>
</span><span id="line-494"></span><span class="hs-comment">-- --   [| do &#120008;&#8321; &#8592; randSml @(SSubst ULCDExpR)</span><span>
</span><span id="line-495"></span><span class="hs-comment">-- --         &#120008;&#8322; &#8592; randSml @(SSubst ULCDExpR)</span><span>
</span><span id="line-496"></span><span class="hs-comment">-- --         return $ &#120008;&#8321; :* &#120008;&#8322;</span><span>
</span><span id="line-497"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-498"></span><span class="hs-comment">-- --   [| \ (&#120008;&#8321; :* &#120008;&#8322;) &#8594; wfSSubst (&#120008;&#8321; &#10746; &#120008;&#8322;) |]</span><span>
</span><span id="line-499"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-500"></span><span class="hs-comment">-- -- &#120099; &quot;zzz:ssubst:refl:hom&quot; 100 </span><span>
</span><span id="line-501"></span><span class="hs-comment">-- --   [| do e &#8592; randSml @ULCDExpR</span><span>
</span><span id="line-502"></span><span class="hs-comment">-- --         return $ e</span><span>
</span><span id="line-503"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-504"></span><span class="hs-comment">-- --   [| \ e &#8594; </span><span>
</span><span id="line-505"></span><span class="hs-comment">-- --        ssubst null e &#8801; e</span><span>
</span><span id="line-506"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-507"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-508"></span><span class="hs-comment">-- -- &#120099; &quot;zzz:ssubst:refl/shift:hom&quot; 100</span><span>
</span><span id="line-509"></span><span class="hs-comment">-- --   [| do n &#8592; randSml @&#8469;64</span><span>
</span><span id="line-510"></span><span class="hs-comment">-- --         e &#8592; randSml @ULCDExpR</span><span>
</span><span id="line-511"></span><span class="hs-comment">-- --         return $ n :* e</span><span>
</span><span id="line-512"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-513"></span><span class="hs-comment">-- --   [| \ (n :* e) &#8594; ssubst (&#120008;shift n null) e &#8801; e </span><span>
</span><span id="line-514"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-515"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-516"></span><span class="hs-comment">-- -- &#120099; &quot;zzz:ssubst:bind&quot; 100</span><span>
</span><span id="line-517"></span><span class="hs-comment">-- --   [| do e&#8321; &#8592; randSml @ULCDExpR</span><span>
</span><span id="line-518"></span><span class="hs-comment">-- --         e&#8322; &#8592; randSml @ULCDExpR</span><span>
</span><span id="line-519"></span><span class="hs-comment">-- --         return $ e&#8321; :* e&#8322;</span><span>
</span><span id="line-520"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-521"></span><span class="hs-comment">-- --   [| \ (e&#8321; :* e&#8322;) &#8594; </span><span>
</span><span id="line-522"></span><span class="hs-comment">-- --        ssubst (&#120008;bbind e&#8321; &#10746; &#120008;intro 1) e&#8322; </span><span>
</span><span id="line-523"></span><span class="hs-comment">-- --        &#8801; </span><span>
</span><span id="line-524"></span><span class="hs-comment">-- --        e&#8322;</span><span>
</span><span id="line-525"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-526"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-527"></span><span class="hs-comment">-- -- &#120099; &quot;zzz:ssubst:commute&quot; 100</span><span>
</span><span id="line-528"></span><span class="hs-comment">-- --   [| do e&#8321; &#8592; randSml @ULCDExpR</span><span>
</span><span id="line-529"></span><span class="hs-comment">-- --         e&#8322; &#8592; randSml @ULCDExpR</span><span>
</span><span id="line-530"></span><span class="hs-comment">-- --         return $ e&#8321; :* e&#8322;</span><span>
</span><span id="line-531"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-532"></span><span class="hs-comment">-- --   [| \ (e&#8321; :* e&#8322;) &#8594; </span><span>
</span><span id="line-533"></span><span class="hs-comment">-- --        ssubst (&#120008;intro 1 &#10746; &#120008;bbind e&#8321;) e&#8322;</span><span>
</span><span id="line-534"></span><span class="hs-comment">-- --        &#8801; </span><span>
</span><span id="line-535"></span><span class="hs-comment">-- --        ssubst (&#120008;shift 1 (&#120008;bbind e&#8321;) &#10746; &#120008;intro 1) e&#8322;</span><span>
</span><span id="line-536"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-537"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-538"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-539"></span><span class="hs-comment">-- -- &#120099; &quot;zzz:ssubst:&#10746;:hom&quot; 100 </span><span>
</span><span id="line-540"></span><span class="hs-comment">-- --   [| do &#120008;&#8321; &#8592; randSml @(SSubst ULCDExpR)</span><span>
</span><span id="line-541"></span><span class="hs-comment">-- --         &#120008;&#8322; &#8592; randSml @(SSubst ULCDExpR)</span><span>
</span><span id="line-542"></span><span class="hs-comment">-- --         e &#8592; randSml @ULCDExpR</span><span>
</span><span id="line-543"></span><span class="hs-comment">-- --         return $ &#120008;&#8321; :* &#120008;&#8322; :* e</span><span>
</span><span id="line-544"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-545"></span><span class="hs-comment">-- --   [| \ (&#120008;&#8321; :* &#120008;&#8322; :* e) &#8594; </span><span>
</span><span id="line-546"></span><span class="hs-comment">-- --        ssubst (&#120008;&#8321; &#10746; &#120008;&#8322;) e &#8801; ssubst &#120008;&#8321; (ssubst &#120008;&#8322; e)</span><span>
</span><span id="line-547"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-548"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-549"></span><span class="hs-comment">-- -- &#120099; &quot;zzz:ssubst:&#10746;:lrefl&quot; 100 </span><span>
</span><span id="line-550"></span><span class="hs-comment">-- --   [| do &#120008; &#8592; randSml @(SSubst ULCDExpR)</span><span>
</span><span id="line-551"></span><span class="hs-comment">-- --         e &#8592; randSml @ULCDExpR</span><span>
</span><span id="line-552"></span><span class="hs-comment">-- --         return $ &#120008; :* e</span><span>
</span><span id="line-553"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-554"></span><span class="hs-comment">-- --   [| \ (&#120008; :* e) &#8594; </span><span>
</span><span id="line-555"></span><span class="hs-comment">-- --        ssubst (null &#10746; &#120008;) e &#8801; ssubst &#120008; e</span><span>
</span><span id="line-556"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-557"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-558"></span><span class="hs-comment">-- -- &#120099; &quot;zzz:ssubst:&#10746;:rrefl&quot; 100 </span><span>
</span><span id="line-559"></span><span class="hs-comment">-- --   [| do &#120008; &#8592; randSml @(SSubst ULCDExpR)</span><span>
</span><span id="line-560"></span><span class="hs-comment">-- --         e &#8592; randSml @ULCDExpR</span><span>
</span><span id="line-561"></span><span class="hs-comment">-- --         return $ &#120008; :* e</span><span>
</span><span id="line-562"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-563"></span><span class="hs-comment">-- --   [| \ (&#120008; :* e) &#8594; </span><span>
</span><span id="line-564"></span><span class="hs-comment">-- --        ssubst (&#120008; &#10746; null) e &#8801; ssubst &#120008; e</span><span>
</span><span id="line-565"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-566"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-567"></span><span class="hs-comment">-- -- &#120099; &quot;zzz:ssubst:&#10746;:lrefl/shift&quot; 100</span><span>
</span><span id="line-568"></span><span class="hs-comment">-- --   [| do n &#8592; randSml @&#8469;64</span><span>
</span><span id="line-569"></span><span class="hs-comment">-- --         &#120008; &#8592; randSml @(SSubst ULCDExpR)</span><span>
</span><span id="line-570"></span><span class="hs-comment">-- --         e &#8592; randSml @ULCDExpR</span><span>
</span><span id="line-571"></span><span class="hs-comment">-- --         return $ n :* &#120008; :* e</span><span>
</span><span id="line-572"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-573"></span><span class="hs-comment">-- --   [| \ (n :* &#120008; :* e) &#8594; ssubst (&#120008;shift n null &#10746; &#120008;) e &#8801; ssubst &#120008; e </span><span>
</span><span id="line-574"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-575"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-576"></span><span class="hs-comment">-- -- &#120099; &quot;zzz:ssubst:&#10746;:rrefl/shift&quot; 100</span><span>
</span><span id="line-577"></span><span class="hs-comment">-- --   [| do n &#8592; randSml @&#8469;64</span><span>
</span><span id="line-578"></span><span class="hs-comment">-- --         &#120008; &#8592; randSml @(SSubst ULCDExpR)</span><span>
</span><span id="line-579"></span><span class="hs-comment">-- --         e &#8592; randSml @ULCDExpR</span><span>
</span><span id="line-580"></span><span class="hs-comment">-- --         return $ n :* &#120008; :* e</span><span>
</span><span id="line-581"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-582"></span><span class="hs-comment">-- --   [| \ (n :* &#120008; :* e) &#8594; ssubst (&#120008; &#10746; &#120008;shift n null) e &#8801; ssubst &#120008; e </span><span>
</span><span id="line-583"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-584"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-585"></span><span class="hs-comment">-- -- &#120099; &quot;zzz:ssubst:&#10746;:trans&quot; 100 </span><span>
</span><span id="line-586"></span><span class="hs-comment">-- --   [| do &#120008;&#8321; &#8592; randSml @(SSubst ULCDExpR)</span><span>
</span><span id="line-587"></span><span class="hs-comment">-- --         &#120008;&#8322; &#8592; randSml @(SSubst ULCDExpR)</span><span>
</span><span id="line-588"></span><span class="hs-comment">-- --         &#120008;&#8323; &#8592; randSml @(SSubst ULCDExpR)</span><span>
</span><span id="line-589"></span><span class="hs-comment">-- --         e &#8592; randSml @ULCDExpR</span><span>
</span><span id="line-590"></span><span class="hs-comment">-- --         return $ &#120008;&#8321; :* &#120008;&#8322; :* &#120008;&#8323; :* e</span><span>
</span><span id="line-591"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-592"></span><span class="hs-comment">-- --   [| \ (&#120008;&#8321; :* &#120008;&#8322; :* &#120008;&#8323; :* e) &#8594; </span><span>
</span><span id="line-593"></span><span class="hs-comment">-- --        ssubst ((&#120008;&#8321; &#10746; &#120008;&#8322;) &#10746; &#120008;&#8323;) e &#8801; ssubst (&#120008;&#8321; &#10746; (&#120008;&#8322; &#10746; &#120008;&#8323;)) e </span><span>
</span><span id="line-594"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-595"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-596"></span><span class="hs-comment">-- -- &#120099; &quot;zzz:ssubst:shift/&#10746;:shift:dist&quot; 100 </span><span>
</span><span id="line-597"></span><span class="hs-comment">-- --   [| do n &#8592; randSml @&#8469;64</span><span>
</span><span id="line-598"></span><span class="hs-comment">-- --         &#120008;&#8321; &#8592; randSml @(SSubst ULCDExpR)</span><span>
</span><span id="line-599"></span><span class="hs-comment">-- --         &#120008;&#8322; &#8592; randSml @(SSubst ULCDExpR)</span><span>
</span><span id="line-600"></span><span class="hs-comment">-- --         e &#8592; randSml @ULCDExpR</span><span>
</span><span id="line-601"></span><span class="hs-comment">-- --         return $ n :* &#120008;&#8321; :* &#120008;&#8322; :* e</span><span>
</span><span id="line-602"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-603"></span><span class="hs-comment">-- --   [| \ (n :* &#120008;&#8321; :* &#120008;&#8322; :* e) &#8594; </span><span>
</span><span id="line-604"></span><span class="hs-comment">-- --        ssubst (&#120008;shift n (&#120008;&#8321; &#10746; &#120008;&#8322;)) e &#8801; ssubst (&#120008;shift n &#120008;&#8321; &#10746; &#120008;shift n &#120008;&#8322;) e </span><span>
</span><span id="line-605"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-606"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-607"></span><span class="hs-comment">-- -- &#120099; &quot;zzz:usubst:&#10746;:hom&quot; 100 </span><span>
</span><span id="line-608"></span><span class="hs-comment">-- --   [| do &#120008;&#8321; &#8592; randSml @(USubst ULCDExpR)</span><span>
</span><span id="line-609"></span><span class="hs-comment">-- --         &#120008;&#8322; &#8592; randSml @(USubst ULCDExpR)</span><span>
</span><span id="line-610"></span><span class="hs-comment">-- --         e &#8592; randSml @ULCDExpR</span><span>
</span><span id="line-611"></span><span class="hs-comment">-- --         return $ &#120008;&#8321; :* &#120008;&#8322; :* e</span><span>
</span><span id="line-612"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-613"></span><span class="hs-comment">-- --   [| \ (&#120008;&#8321; :* &#120008;&#8322; :* e) &#8594; </span><span>
</span><span id="line-614"></span><span class="hs-comment">-- --        usubst (&#120008;&#8321; &#10746; &#120008;&#8322;) e &#8801; usubst &#120008;&#8321; (usubst &#120008;&#8322; e)</span><span>
</span><span id="line-615"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-616"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-617"></span><span class="hs-comment">-- -- &#120099; &quot;zzz:usubst:&#10746;:lrefl&quot; 100 </span><span>
</span><span id="line-618"></span><span class="hs-comment">-- --   [| do &#120008; &#8592; randSml @(USubst ULCDExpR)</span><span>
</span><span id="line-619"></span><span class="hs-comment">-- --         e &#8592; randSml @ULCDExpR</span><span>
</span><span id="line-620"></span><span class="hs-comment">-- --         return $ &#120008; :* e</span><span>
</span><span id="line-621"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-622"></span><span class="hs-comment">-- --   [| \ (&#120008; :* e) &#8594; </span><span>
</span><span id="line-623"></span><span class="hs-comment">-- --        usubst (null &#10746; &#120008;) e &#8801; usubst &#120008; e</span><span>
</span><span id="line-624"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-625"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-626"></span><span class="hs-comment">-- -- &#120099; &quot;zzz:usubst:&#10746;:rrefl&quot; 100 </span><span>
</span><span id="line-627"></span><span class="hs-comment">-- --   [| do &#120008; &#8592; randSml @(USubst ULCDExpR)</span><span>
</span><span id="line-628"></span><span class="hs-comment">-- --         e &#8592; randSml @ULCDExpR</span><span>
</span><span id="line-629"></span><span class="hs-comment">-- --         return $ &#120008; :* e</span><span>
</span><span id="line-630"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-631"></span><span class="hs-comment">-- --   [| \ (&#120008; :* e) &#8594; </span><span>
</span><span id="line-632"></span><span class="hs-comment">-- --        usubst (&#120008; &#10746; null) e &#8801; usubst &#120008; e</span><span>
</span><span id="line-633"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-634"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-635"></span><span class="hs-comment">-- -- &#120099; &quot;zzz:usubst:&#10746;:trans&quot; 100 </span><span>
</span><span id="line-636"></span><span class="hs-comment">-- --   [| do &#120008;&#8321; &#8592; randSml @(USubst ULCDExpR)</span><span>
</span><span id="line-637"></span><span class="hs-comment">-- --         &#120008;&#8322; &#8592; randSml @(USubst ULCDExpR)</span><span>
</span><span id="line-638"></span><span class="hs-comment">-- --         &#120008;&#8323; &#8592; randSml @(USubst ULCDExpR)</span><span>
</span><span id="line-639"></span><span class="hs-comment">-- --         e &#8592; randSml @ULCDExpR</span><span>
</span><span id="line-640"></span><span class="hs-comment">-- --         return $ &#120008;&#8321; :* &#120008;&#8322; :* &#120008;&#8323; :* e</span><span>
</span><span id="line-641"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-642"></span><span class="hs-comment">-- --   [| \ (&#120008;&#8321; :* &#120008;&#8322; :* &#120008;&#8323; :* e) &#8594; </span><span>
</span><span id="line-643"></span><span class="hs-comment">-- --        usubst ((&#120008;&#8321; &#10746; &#120008;&#8322;) &#10746; &#120008;&#8323;) e &#8801; usubst (&#120008;&#8321; &#10746; (&#120008;&#8322; &#10746; &#120008;&#8323;)) e </span><span>
</span><span id="line-644"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-645"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-646"></span><span class="hs-comment">-- -- &#120099; &quot;zzz:ssubst:open&#8728;close&quot; 100 </span><span>
</span><span id="line-647"></span><span class="hs-comment">-- --   [| do randSml @ULCDExpR</span><span>
</span><span id="line-648"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-649"></span><span class="hs-comment">-- --   [| \ e &#8594; </span><span>
</span><span id="line-650"></span><span class="hs-comment">-- --        ssubst (&#120008;open (var &quot;z&quot;) &#10746; &#120008;close (var &quot;z&quot;)) e &#8801; e</span><span>
</span><span id="line-651"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-652"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-653"></span><span class="hs-comment">-- -- &#120099; &quot;zzz:ssubst:close&#8728;open&quot; 100 </span><span>
</span><span id="line-654"></span><span class="hs-comment">-- --   [| do randSml @ULCDExpR</span><span>
</span><span id="line-655"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-656"></span><span class="hs-comment">-- --   [| \ e &#8594; </span><span>
</span><span id="line-657"></span><span class="hs-comment">-- --        ssubst (&#120008;close (var &quot;z&quot;) &#10746; &#120008;open (var &quot;z&quot;)) e &#8801; e</span><span>
</span><span id="line-658"></span><span class="hs-comment">-- --   |]</span><span>
</span><span id="line-659"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-660"></span><span class="hs-comment">-- -- buildTests</span><span>
</span><span id="line-661"></span><span class="hs-comment">-- -- </span><span>
</span><span id="line-662"></span><span class="hs-comment">-- -- -}</span><span>
</span><span id="line-663"></span></pre></body></html>